/**
 * Mobile Optimizations
 * 
 * This file contains CSS optimizations specifically for mobile devices
 * to improve scrolling performance and reduce UI jank.
 */

@media (max-width: 768px) {
  /* Apply passive touch handling to all scrollable elements */
  .scrollable,
  div,
  main,
  section,
  article,
  aside,
  nav,
  footer,
  header,
  ul,
  ol {
    -webkit-overflow-scrolling: touch;
    scroll-behavior: auto; /* Disable smooth scrolling on mobile for better performance */
  }

  /* Prevent repaints during scrolling */
  body * {
    /* Prevent hover effects from causing repaints during scrolling */
    will-change: auto; /* Reset any will-change to automatic optimization */
    transform: translateZ(0); /* Promote to a layer only when needed */
    backface-visibility: hidden; /* Reduces paints for elements that move */
  }

  /* Optimize transitions and animations */
  *, *::before, *::after {
    transition-duration: 0.15s !important; /* Shorter transitions on mobile */
    animation-duration: 0.5s !important; /* Shorter animations on mobile */
  }

  /* Optimize fixed/sticky elements that might cause paint issues */
  .fixed, 
  .sticky, 
  [style*="position: fixed"], 
  [style*="position: sticky"] {
    transform: translateZ(0); /* Force GPU acceleration */
    contain: layout; /* Layout containment for better paint performance */
  }

  /* Optimize scrollable containers */
  .scrollable-container,
  [style*="overflow: auto"],
  [style*="overflow: scroll"],
  [style*="overflow-y: auto"],
  [style*="overflow-y: scroll"] {
    -webkit-overflow-scrolling: touch; /* Smooth scrolling on iOS */
    overscroll-behavior: contain; /* Prevent scroll chaining */
    scroll-padding: 10px; /* Better touch scrolling */
    scrollbar-width: thin; /* Thinner scrollbars on Firefox */
  }

  /* Reduce motion for users who prefer it */
  @media (prefers-reduced-motion: reduce) {
    *, *::before, *::after {
      animation-duration: 0.001s !important; /* Essentially disable animations */
      transition-duration: 0.001s !important; /* Essentially disable transitions */
      scroll-behavior: auto !important; /* Disable smooth scrolling */
    }
  }

  /* Better touch targets for mobile */
  button,
  a,
  input,
  select,
  [role="button"],
  [tabindex]:not([tabindex="-1"]) {
    min-height: 40px; /* Minimum touch target height */
    min-width: 40px; /* Minimum touch target width */
  }

  /* Optimize images and media */
  img, 
  video, 
  canvas, 
  picture, 
  svg {
    content-visibility: auto; /* Automatic content visibility optimization */
    contain: content; /* Content containment for better paint performance */
  }

  /* Optimize layout transitions on mobile */
  .layout-transition,
  [data-animation],
  [class*="motion-"],
  [class*="animate-"],
  [class*="transition-"] {
    transform: translateZ(0); /* Force GPU acceleration */
    will-change: transform, opacity; /* Optimize for common animations */
    transition-property: transform, opacity; /* Limit transition to these properties */
  }

  /* Optimize hardware acceleration selectively */
  .hardware-accelerated,
  .gpu-accelerated,
  [style*="transform"],
  [style*="opacity"],
  [style*="filter"] {
    transform: translateZ(0); /* Force GPU acceleration */
    backface-visibility: hidden; /* Reduces paints for elements that move */
    perspective: 1000; /* Helps with 3D transforms */
  }

  /* Prevent browser address bar appearance/disappearance causing layout shifts */
  html, 
  body {
    height: 100%; /* Use full height */
    overflow-x: hidden; /* Prevent horizontal overflow */
    overscroll-behavior-y: none; /* Prevent pull-to-refresh */
    position: fixed; /* Fix the viewport */
    width: 100%; /* Use full width */
    overflow-y: auto; /* Allow vertical scrolling */
  }

  /* Prevent 300ms tap delay on touch devices */
  a, button, [role="button"] {
    touch-action: manipulation;
  }
  
  /* Disable hover effects on mobile */
  [class*="hover:"] {
    transition: none !important;
  }
  
  /* Optimize list rendering */
  ul, ol, dl {
    content-visibility: auto;
    contain-intrinsic-size: 0 500px; /* Provide size hint for hidden content */
  }
  
  /* Optimize grid and flex layouts */
  .grid, .flex, [class*="grid-"], [class*="flex-"] {
    contain: layout style;
  }
}

/* Optimization specifically for low-end devices */
@media (max-width: 768px) and (prefers-reduced-motion) {
  /* Disable all animations completely */
  *, *::before, *::after {
    animation: none !important;
    transition: none !important;
    scroll-behavior: auto !important;
  }
  
  /* Simplify all effects */
  [class*="shadow-"],
  [class*="blur-"],
  [filter],
  [style*="filter"] {
    filter: none !important;
    box-shadow: none !important;
  }
}